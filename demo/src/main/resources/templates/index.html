<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Biblioconnect</title>
    <style>
        body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 40px auto; }
        header { text-align:center; margin-bottom:20px }
        h1 { color:#2c3e50; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.06); margin-bottom:16px }
        .btn { background:#4285F4; color:white; padding:10px 16px; border-radius:4px; text-decoration:none; display:inline-block }
        .muted { color:#666; font-size:0.95em }
        .user { float:right; font-size:0.95em }
        .clear { clear:both }
        .book-list { display:flex; flex-direction:column; gap:10px }
        .book-item { border:1px solid #eee; padding:12px; border-radius:6px; background:#fafafa }
        .book-meta { color:#555; font-size:0.9em }
        .actions { margin-top:8px }
        .danger { background:#e74c3c }
        .search { display:flex; gap:8px; align-items:center }
        .search input[type=text] { padding:8px; flex:1; border:1px solid #ccc; border-radius:4px }
    </style>
</head>
<body>
<header>
    <h1>Biblioconnect</h1>
    <p class="muted">Sistema de empréstimo de livros entre alunos e comunidade — compartilhe, empreste e descubra leituras.</p>
</header>
<div class="card">
    <div th:if="${userName}">
        <div class="user">
            <span th:if="${picture}"><img th:src="${picture}" alt="avatar" style="width:48px;height:48px;border-radius:50%;vertical-align:middle;margin-right:8px"/></span>
            <strong th:text="${userName}">Usuário</strong>
            (<span th:text="${userEmail}">email</span>)
        </div>
        <h2>Bem-vindo ao Biblioconnect</h2>
        <p>Você está autenticado. Aqui no futuro você poderá procurar livros, listar seus empréstimos, cadastrar ofertas de livros e gerenciar solicitações.</p>
        <p>
            <a th:href="@{/logout}" onclick="event.preventDefault(); document.getElementById('logoutForm').submit();" class="btn">Sair</a>
        </p>
        <form id="logoutForm" th:action="@{/logout}" method="post" style="display:none">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        </form>
    </div>

    <div th:unless="${userName}">
        <h2>Entrar ou criar conta</h2>
        <p>Para começar a compartilhar e pedir livros, faça login ou crie uma conta.</p>
        <p>
            <a class="btn" th:href="@{/login}">Entrar</a>
            <span style="display:inline-block;width:10px"></span>
            <a class="btn" th:href="@{/register}">Cadastrar</a>
        </p>
        <div th:if="${hasGoogle}">
            <hr/>
            <p class="muted">Ou entre com sua conta Google</p>
            <a class="btn" th:href="@{/oauth2/authorization/google}">Entrar com Google</a>
        </div>
    </div>
    <div class="clear"></div>
</div>

<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Livros disponíveis</h2>
        <div>
            <a th:if="${canAdd}" class="btn" th:href="@{/books/new}">Adicionar livros</a>
        </div>
    </div>

    <div style="margin-top:10px; margin-bottom:10px">
        <form th:action="@{/}" method="get" class="search">
            <input type="text" name="q" th:value="${q}" placeholder="Buscar por título ou autor" />
            <button type="submit" class="btn">Buscar</button>
            <a th:if="${q}" th:href="@{/}" style="margin-left:8px">Limpar</a>
        </form>
    </div>

    <div class="book-list">
        <div class="book-item" th:each="book : ${books}">
            <div>
                <strong th:text="${book.title}">Título</strong>
                <span class="book-meta"> — <span th:text="${book.authors}">Autores</span></span>
            </div>
            <div class="book-meta">
                <span th:if="${book.publishedYear}">Ano: <span th:text="${book.publishedYear}"></span> • </span>
                <span th:if="${book.publisher}">Editora: <span th:text="${book.publisher}"></span> • </span>
                <span>Categoria: <span th:text="${book.category}"></span></span>
            </div>
            <div class="book-meta">Local: <span th:text="${book.location}"></span> • Idioma: <span th:text="${book.language}"></span></div>
            <div class="actions">
                <a class="btn" th:href="@{/books/{id}(id=${book.id})}">Ver</a>
                <span th:if="${book.owner != null}">
                    <span class="muted">cadastrado por <strong th:text="${book.owner.name}"></strong></span>
                </span>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(books)}" class="muted">Nenhum livro cadastrado ainda.</div>
    </div>
</div>

</body>
</html>
